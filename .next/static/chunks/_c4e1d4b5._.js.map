{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/FPOLY/ky5/ASM_Next/Pure-Botanica/src/app/admin/product/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport styles from \"./Product.module.css\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Image from \"next/image\";\r\nimport Link from \"next/link\";\r\n\r\ninterface Category {\r\n  _id: string;\r\n  name: string;\r\n  createdAt: string;\r\n}\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  price: number;\r\n  discountPrice?: number;\r\n  stock: number;\r\n  images?: string[];\r\n  category?: Category;\r\n  description?: string;\r\n  ingredients?: string[];\r\n  usage_instructions?: string[];\r\n  special?: string[];\r\n}\r\n\r\nexport default function ProductPage() {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [deleteId, setDeleteId] = useState<string | null>(null);\r\n  const [notification, setNotification] = useState({ show: false, message: \"\", type: \"\" });\r\n  const productsPerPage = 9;\r\n\r\n  const router = useRouter();\r\n\r\n  // Kiểm tra quyền admin\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n    const role = localStorage.getItem(\"role\");\r\n\r\n    if (!token || role !== \"admin\") {\r\n      router.push(\"/login\");\r\n    }\r\n  }, [router]);\r\n\r\n  // Lấy danh sách sản phẩm và danh mục\r\n  useEffect(() => {\r\n    fetchProducts();\r\n    fetchCategories();\r\n  }, []);\r\n\r\n  const showNotification = (message: string, type: string) => {\r\n    setNotification({ show: true, message, type });\r\n    setTimeout(() => {\r\n      setNotification({ show: false, message: \"\", type: \"\" });\r\n    }, 3000);\r\n  };\r\n\r\n  const fetchProducts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await fetch(\"https://api-zeal.onrender.com/api/products\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        cache: \"no-store\",\r\n      });\r\n      if (res.status === 401 || res.status === 403) {\r\n        alert(\"Phiên đăng nhập hết hạn. Vui lòng đăng nhập lại!\");\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"role\");\r\n        localStorage.removeItem(\"email\");\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n      if (!res.ok) {\r\n        throw new Error(`Lỗi API: ${res.status} ${res.statusText}`);\r\n      }\r\n      const data = await res.json();\r\n      if (!Array.isArray(data)) {\r\n        throw new Error(\"Dữ liệu sản phẩm không hợp lệ\");\r\n      }\r\n      setProducts(data);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : \"Lỗi không xác định\";\r\n      console.error(\"Lỗi khi tải danh sách sản phẩm:\", errorMessage);\r\n      setError(\"Không thể tải danh sách sản phẩm. Vui lòng thử lại sau.\");\r\n      showNotification(\"Không thể tải danh sách sản phẩm\", \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await fetch(\"https://api-zeal.onrender.com/api/categories\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        cache: \"no-store\",\r\n      });\r\n      if (res.status === 401 || res.status === 403) {\r\n        alert(\"Phiên đăng nhập hết hạn. Vui lòng đăng nhập lại!\");\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"role\");\r\n        localStorage.removeItem(\"email\");\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n      if (!res.ok) {\r\n        throw new Error(`Lỗi API: ${res.status} ${res.statusText}`);\r\n      }\r\n      const data = await res.json();\r\n      if (!Array.isArray(data)) {\r\n        throw new Error(\"Dữ liệu danh mục không hợp lệ\");\r\n      }\r\n      setCategories(data);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : \"Lỗi không xác định\";\r\n      console.error(\"Lỗi khi tải danh mục:\", errorMessage);\r\n      showNotification(\"Không thể tải danh mục\", \"error\");\r\n    }\r\n  };\r\n\r\n  const confirmDelete = (id: string) => {\r\n    setDeleteId(id);\r\n    setIsDeleting(true);\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!deleteId) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(`https://api-zeal.onrender.com/api/products/${deleteId}`, {\r\n        method: \"DELETE\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n\r\n      if (response.status === 401 || response.status === 403) {\r\n        alert(\"Phiên đăng nhập hết hạn. Vui lòng đăng nhập lại!\");\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"role\");\r\n        localStorage.removeItem(\"email\");\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw new Error(`Lỗi HTTP: ${response.status} - ${errorText}`);\r\n      }\r\n\r\n      setProducts(products.filter((product) => product._id !== deleteId));\r\n      setIsDeleting(false);\r\n      setDeleteId(null);\r\n      showNotification(\"Xóa sản phẩm thành công\", \"success\");\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : \"Lỗi không xác định\";\r\n      console.error(\"Lỗi khi xóa sản phẩm:\", errorMessage);\r\n      showNotification(\"Đã xảy ra lỗi khi xóa sản phẩm\", \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const totalPages = Math.ceil(products.length / productsPerPage);\r\n  const indexOfLastProduct = currentPage * productsPerPage;\r\n  const indexOfFirstProduct = indexOfLastProduct - productsPerPage;\r\n  const currentProducts = products.slice(indexOfFirstProduct, indexOfLastProduct);"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file://D%3A/FPOLY/ky5/ASM_Next/Pure-Botanica/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}