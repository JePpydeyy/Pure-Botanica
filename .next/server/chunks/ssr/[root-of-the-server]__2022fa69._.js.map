{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file://D%3A/FPOLY/ky5/ASM_Next/Pure-Botanica/src/app/admin/comment/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport \"./comment.css\";\r\n\r\nexport default function Comment() {\r\n  interface Comment {\r\n    _id: string;\r\n    user: {\r\n      _id: string;\r\n      username: string;\r\n      email: string;\r\n    };\r\n    product: {\r\n      _id: string;\r\n      name: string;\r\n      price: number;\r\n      images: string[];\r\n    };\r\n    content: string;\r\n    createdAt: string;\r\n    updatedAt?: string;\r\n  }\r\n\r\n  const [comments, setComments] = useState<Comment[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n\r\n  // Fetch comments from API\r\n  useEffect(() => {\r\n    const fetchComments = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\"); // Lấy token từ localStorage\r\n        if (!token) {\r\n          setError(\"Không tìm thấy token. Vui lòng đăng nhập lại.\");\r\n          return;\r\n        }\r\n\r\n        const response = await axios.get<Comment[]>(\"https://api-zeal.onrender.com/api/comments/\", {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`, // Gửi token trong header\r\n          },\r\n        });\r\n\r\n        setComments(response.data);\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(\"Lỗi khi tải danh sách bình luận:\", error);\r\n        setError(\"Không thể tải danh sách bình luận\");\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchComments();\r\n  }, []);\r\n\r\n  // Format date\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return `${date.getDate().toString().padStart(2, \"0\")}-${(date.getMonth() + 1)\r\n      .toString()\r\n      .padStart(2, \"0\")}-${date.getFullYear()}`;\r\n  };\r\n\r\n  // Handle delete comment\r\n  const handleDelete = async (commentId: string, userId: string) => {\r\n    const confirmDelete = window.confirm(\"Bạn có chắc chắn muốn xóa bình luận này?\");\r\n    if (!confirmDelete) return;\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\"); // Lấy token từ localStorage\r\n      if (!token) {\r\n        alert(\"Không tìm thấy token. Vui lòng đăng nhập lại.\");\r\n        return;\r\n      }\r\n\r\n      await axios.request({\r\n        url: `https://api-zeal.onrender.com/api/comments/${commentId}`,\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`, // Gửi token trong header\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        data: { userId }, // Truyền userId trong body\r\n      });\r\n\r\n      setComments((prevComments) => prevComments.filter((comment) => comment._id !== commentId));\r\n      alert(\"Xóa bình luận thành công!\");\r\n    } catch (error: any) {\r\n      console.error(\"Lỗi khi xóa bình luận:\", error);\r\n      const errorMessage =\r\n        error.response?.data?.error || \"Không thể xóa bình luận. Vui lòng thử lại.\";\r\n      alert(errorMessage);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"loading-message\">Đang tải...</div>;\r\n  if (error) return <div className=\"error-message\">{error}</div>;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"title_container\">\r\n        <h1>BÌNH LUẬN</h1>\r\n      </div>\r\n      <div className=\"comments-container\">\r\n        <ul className=\"tabs\">\r\n          <li className=\"active\">Tất cả bình luận</li>\r\n        </ul>\r\n        <table className=\"comments-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>ID</th>\r\n              <th>Tên</th>\r\n              <th>Email</th>\r\n              <th>Sản Phẩm</th>\r\n              <th>Hình Ảnh</th>\r\n              <th>Nội Dung</th>\r\n              <th>Ngày</th>\r\n              <th>Hành Động</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {comments.map((comment, index) => (\r\n              <tr key={comment._id}>\r\n                <td>{index + 1}</td>\r\n                <td>{comment.user.username}</td>\r\n                <td>{comment.user.email}</td>\r\n                <td>{comment.product.name}</td>\r\n                <td>\r\n                  <img\r\n                    src={`https://api-zeal.onrender.com/images/${comment.product.images[0]}`}\r\n                    alt={comment.product.name}\r\n                    className=\"product-image\"\r\n                  />\r\n                </td>\r\n                <td>{comment.content}</td>\r\n                <td>{formatDate(comment.createdAt)}</td>\r\n                <td>\r\n                  <button\r\n                    className=\"delete-btn\"\r\n                    onClick={() => handleDelete(comment._id, comment.user._id)} // Truyền comment._id và comment.user._id\r\n                  >\r\n                    Xóa\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}