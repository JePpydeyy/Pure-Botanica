{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file://D%3A/FPOLY/ky5/ASM_Next/Pure-Botanica/src/app/admin/order/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport \"./order.css\"; // Đảm bảo file CSS tồn tại và được tối ưu\r\n\r\ninterface Order {\r\n  _id: string;\r\n  user: {\r\n    username: string;\r\n  };\r\n  address?: string;\r\n  createdAt: string;\r\n  status: string;\r\n}\r\n\r\nexport default function OrderPage() {\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  // Danh sách trạng thái có thể chọn\r\n  const statusOptions = [\"Pending\", \"Delivered\", \"Cancelled\"];\r\n\r\n  // Kiểm tra biến môi trường\r\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL;\r\n  if (!apiUrl) {\r\n    console.error(\"NEXT_PUBLIC_API_URL không được định nghĩa trong .env\");\r\n  }\r\n\r\n  // Lấy danh sách đơn hàng từ API\r\n  const fetchOrders = useCallback(async () => {\r\n    if (!apiUrl) {\r\n      setError(\"Cấu hình API không hợp lệ. Vui lòng kiểm tra biến môi trường.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await axios.get<Order[]>(`${apiUrl}/orders/all`, {\r\n        timeout: 10000,\r\n      });\r\n      setOrders(response.data);\r\n      setLoading(false);\r\n    } catch (error: any) {\r\n      console.error(\"Lỗi khi lấy đơn hàng:\", error);\r\n      setError(\r\n        error.response?.data?.message ||\r\n          \"Không thể tải danh sách đơn hàng. Vui lòng thử lại.\"\r\n      );\r\n      setLoading(false);\r\n    }\r\n  }, [apiUrl]); // Thêm apiUrl vào mảng phụ thuộc\r\n\r\n  useEffect(() => {\r\n    fetchOrders();\r\n  }, [fetchOrders]);\r\n\r\n  // Cập nhật trạng thái đơn hàng\r\n  const updateOrderStatus = async (orderId: string, newStatus: string) => {\r\n    if (!apiUrl) {\r\n      alert(\"Cấu hình API không hợp lệ. Vui lòng kiểm tra biến môi trường.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await axios.patch(\r\n        `${apiUrl}/orders/${orderId}`,\r\n        { status: newStatus },\r\n        { timeout: 5000 }\r\n      );\r\n      setOrders((prevOrders) =>\r\n        prevOrders.map((order) =>\r\n          order._id === orderId ? { ...order, status: newStatus } : order\r\n        )\r\n      );\r\n      alert(`Cập nhật trạng thái đơn hàng ${orderId} thành công!`);\r\n    } catch (error: any) {\r\n      console.error(\"Lỗi khi cập nhật trạng thái:\", error);\r\n      alert(\r\n        error.response?.data?.message ||\r\n          \"Không thể cập nhật trạng thái. Vui lòng thử lại.\"\r\n      );\r\n    }\r\n  };\r\n\r\n  // Định dạng ngày tháng\r\n  const formatDate = (dateString: string | number | Date): string => {\r\n    try {\r\n      const date = new Date(dateString);\r\n      if (isNaN(date.getTime())) throw new Error(\"Ngày không hợp lệ\");\r\n      return date.toLocaleDateString(\"vi-VN\", {\r\n        day: \"2-digit\",\r\n        month: \"2-digit\",\r\n        year: \"numeric\",\r\n      });\r\n    } catch {\r\n      return \"Ngày không hợp lệ\";\r\n    }\r\n  };\r\n\r\n  // Điều hướng đến trang chi tiết\r\n  const handleViewDetails = (orderId: string) => {\r\n    router.push(`/admin/orderdetail/${orderId}`);\r\n  };\r\n\r\n  // Thử lại khi lỗi\r\n  const handleRetry = () => {\r\n    setError(null);\r\n    setLoading(true);\r\n    fetchOrders();\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-message\">\r\n        <div className=\"spinner\" /> Đang tải...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"error-message\">\r\n        {error}\r\n        <button onClick={handleRetry} className=\"retry-button\">\r\n          Thử lại\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"order-container\">\r\n      <div className=\"title\">\r\n        <h1>Danh Sách Đơn Hàng</h1>\r\n      </div>\r\n      {orders.length === 0 ? (\r\n        <div className=\"empty-message\">Không tìm thấy đơn hàng nào.</div>\r\n      ) : (\r\n        <div className=\"table-container\">\r\n          <table role=\"grid\">\r\n            <thead>\r\n              <tr>\r\n                <th>ID</th>\r\n                <th>Tên</th>\r\n                <th>Địa Chỉ</th>\r\n                <th>Ngày</th>\r\n                <th>Trạng Thái</th>\r\n                <th>Hành Động</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {orders.map((order, index) => (\r\n                <tr key={order._id} role=\"row\" className=\"clickable-row\">\r\n                  <td>{index + 1}</td>\r\n                  <td>{order.user?.username ?? \"Không xác định\"}</td>\r\n                  <td>{order.address || \"Chưa cung cấp địa chỉ\"}</td>\r\n                  <td>{formatDate(order.createdAt)}</td>\r\n                  <td>\r\n                    <select\r\n                      value={order.status}\r\n                      onChange={(e) => updateOrderStatus(order._id, e.target.value)}\r\n                      className=\"status-select\"\r\n                    >\r\n                      {statusOptions.map((status) => (\r\n                        <option key={status} value={status}>\r\n                          {status === \"Pending\"\r\n                            ? \"Đang xử lý\"\r\n                            : status === \"Delivered\"\r\n                            ? \"Đã giao\"\r\n                            : \"Hủy\"}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </td>\r\n                  <td>\r\n                    <button\r\n                      onClick={() => handleViewDetails(order._id)}\r\n                      className=\"view-details-button\"\r\n                    >\r\n                      Xem chi tiết\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}